{% extends 'base.html' %}
{% load staticfiles bootstrap3 %}

{% block content %}
<head>
    <title> {{ view.page_title }} | Playa ;)</title>
    <link href="{% static 'bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'style.css' %}" rel="stylesheet">
    <script src="{% static 'jquery-3.0.0.min.js' %}"></script>

    <style>
        #map {
        position: relative;
        right: 0;

        height: 50%;
        width: 50%;
        overflow: auto;

        }

    </style>
</head>

<div>
    <h1 id="title" style="float: left;">Add a new location:</h1>
    <div style="float: right;">
        <a href="{% url 'footy:new_match' %}"><button type="button" class="action-button shadow animate blue mybtn"><h2 style="color: white;">Choose an existing
            location</h2></button></a>
    </div>
</div>
<form name="add_location" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {% bootstrap_form form %}

    <div id="map">

    </div>

    {% buttons %}
    <button type="submit" class="btn btn-primary btn-lg" id="btn" style="float: right;">
        Next {% bootstrap_icon "menu-right" %}
    </button>
    {% endbuttons %}
</form>
<script>
        initMap = function initMap() {
        window.onload = function() {
             var startPos;
             var geoSuccess = function(position) {

                    startPos = position;
                    console.log(position);
                    console.log(startPos.coords.latitude);
                    console.log(startPos.coords.longitude);
             };
             navigator.geolocation.getCurrentPosition(geoSuccess);
             };
            var myLatlng = new google.maps.LatLng( -34.397, 150.644);

            var mapOptions = {
                zoom: 15,
                center: myLatlng
            }
            var map = new google.maps.Map(document.getElementById("map"), mapOptions);

            // Place a draggable marker on the map
            var marker = new google.maps.Marker({
                position: myLatlng,
                map: map,
                draggable: true,
                title: "Drag me!"
            });
            document.getElementById("id_lng").value =  myLatlng.lat().toFixed(4);
            document.getElementById("id_lat").value =  myLatlng.lat().toFixed(4);

            google.maps.event.addListener(marker, 'dragend', function (evt) {
                document.getElementById("id_lng").value =  evt.latLng.lng().toFixed(4);
                document.getElementById("id_lat").value =  evt.latLng.lat().toFixed(4);
             });

         if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            var pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };

            marker.setPosition(pos);
            map.setCenter(pos);
          }, function() {
            handleLocationError(true, map.getCenter());
          });
        } else {
          // Browser doesn't support Geolocation
          handleLocationError(false, map.getCenter());
        }


      function handleLocationError(browserHasGeolocation, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The Geolocation service failed.' :
                              'Error: Your browser doesn\'t support geolocation.');

        };

};

    </script>




<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyChig6ije2wDaAL7zUaZ2a_adjTKS5OkSI&libraries=places&callback=initMap"
        async defer></script>
{% endblock %}